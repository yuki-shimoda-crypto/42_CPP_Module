#!/bin/bash

# テスト対象のデフォルトと実行パス設定
TARGET=${TARGET:-RPN}
TARGET="./$TARGET"

# 成功するテストケース
SUCCESS_TESTCASES=(
  '1 2 +'
  '8 9 * 9 - 9 - 9 - 4 - 1 +'
  '7 7 * 7 -'
  '9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************' #inf
  '1 0 /' #inf
  '1 2 - 0 /' #-inf
)

# 失敗が許容されるテストケース
FAIL_TESTCASES=(
  '1 2 _2 / 2_ 2 4 - +'
  '(1 + 1)'
  '+'
  '0.1 + 0.1'
  ''
  '1 1 + +'
  '1 2 3 +'
)

# 成功するテスト関数
function test_success() {
  echo $TARGET "\"$1\""
  if ! $TARGET "$1"; then
    FAILED=1
  fi
}

# 失敗が許容されるテスト関数
function test_fail() {
  echo $TARGET "\"$1\""
  if $TARGET "$1"; then
    FAILED=1
  fi
}

# 成功するテストの実行
for tc in "${SUCCESS_TESTCASES[@]}"; do
  test_success "$tc"
done

# 失敗するテストの実行
for tc in "${FAIL_TESTCASES[@]}"; do
  test_fail "$tc"
done

# 結果の判定  
if [ -n "$FAILED" ]; then
  echo "Some tests failed"
else
  echo "All tests succeeded"  
fi
